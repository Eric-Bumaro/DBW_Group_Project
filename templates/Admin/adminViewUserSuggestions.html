<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin view user suggestions!</title>
    <base href="/">
    <link rel="stylesheet" type="text/css" href="/static/Admin/adminViewUserSuggestions.css">
</head>
<script src="/static/jquery-3.4.1.min.js"></script>
<script>
    var nodeList = document.getElementsByClassName("ChooseFunction");
    var listToDelete = "";
    var listToHide="";
    var listToShow="";
    function showChoose() {
        for (var i = 0; i < nodeList.length; i++) {
            nodeList[i].style.display = "block";
        }
        document.getElementById("toChooseButton").style.display = "none";
    }

    function toDelete() {
        $.ajax({
            type: "POST",
            url: "{% url 'USFP:adminDeleteSuggestions' %}",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                listToDelete:listToDelete,
            },
            success: function (response) {
                window.location.reload();
            }
        });
    }
    function toHide() {
        $.ajax({
            type: "POST",
            url: "{% url 'USFP:adminHideSuggestions' %}",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                listToHide:listToHide,
            },
            success: function (response) {
                window.location.reload();
            }
        });
    }

    function cancelDelete() {
        for (var i = 0; i < nodeList.length; i++) {
            nodeList[i].style.display = "none";
            nodeList[i].checked = false;
            listToDelete = "";
        }
        document.getElementById("toChooseButton").style.display = "block";
    }

    function allChooseToDelete() {
        listToDelete = "";
        for (var i = 0; i < nodeList.length; i++) {
            nodeList[i].checked = true;
            if (nodeList[i].value !== undefined && !isNaN(nodeList[i].value)) {
                listToDelete += nodeList[i].value+"-";
            }
        }
    }

    function allChooseToHide() {
        listToDelete = "";
        for (var i = 0; i < nodeList.length; i++) {
            nodeList[i].checked = true;
            if (nodeList[i].value !== undefined && !isNaN(nodeList[i].value)) {
                listToHide += nodeList[i].value+"-";
            }
        }
    }

    function oneChooseToDelete(element) {
        if (element.checked) {
            listToDelete += element.value + "-";
        } else {
            element.checked = false;
            listToDelete = listToDelete.replace(toString(element.value), "");
        }
    }

    function oneChooseToHide(element) {
        if (element.checked) {
            listToHide += element.value + "-";
        } else {
            element.checked = false;
            listToHide = listToHide.replace(toString(element.value), "");
        }
    }

    function oneChooseToShow(element) {
        if (element.checked) {
            listToShow += element.value + "-";
        } else {
            element.checked = false;
            listToShow = listToShow.replace(toString(element.value), "");
        }
    }
</script>
<body>
<h1>You can view your suggestions here:</h1>
<button onclick="showChoose()" id="tochooseButton">Click to choose</button>
<button onclick="toDelete()" class="ChooseFunction" style="display: none">Delete</button>
<button onclick="cancelDelete()" class="ChooseFunction" style="display: none">Cancel</button>
<table border="1" cellspacing="0">
    <tr>
        <th>
            Count
        </th>
        <th>
            Suggestion ID
        </th>
        <th>
            Post Time
        </th>
        <th>
            Last Modify Time
        </th>
        <th>
            Visible
        </th>
        <th>
            View
        </th>
        <th class="ChooseFunction" style="display: none">
            Choose the state of visible
        </th>
    </tr>
    {% for i in prepageData %}
        <tr>
            <td>
                {{ forloop.counter }}
            </td>
            <td>
                {{ i.suggestionID }}
            </td>
            <td>
                {{ i.postTime }}
            </td>
            <td>
                {{ i.modifyTime }}
            </td>
            <td>
                {{ i.visible }}
            </td>
            <td>
                <a href="{% url 'USFP:adminViewOneSuggestion' i.suggestionID %}">View the suggestion</a>
            </td>
            <td class="ChooseFunction" style="display: none">
                {% if i.visible %}
                    Hide the suggestion<input type="checkbox" class="ChooseFunction" value={{ i.commonUserID }} onclick="oneChooseToHide(this)">
                {% else %}
                    Show it to the public<input type="checkbox" class="ChooseFunction" value={{ i.commonUserID }} onclick="oneChooseToShow(this)">
                {% endif %}
            </td>
            <td class="ChooseFunction" style="display: none">
                Delete it <input type="checkbox" class="ChooseFunction" value={{ i.commonUserID }} onclick="oneChooseToDelete(this)">
            </td>
        </tr>
    {% endfor %}
</table>
<br>
{% if prepageData.has_previous %}
    <a href="{% url 'USFP:adminViewUserSuggestions' commonUserID prepageData.previous_page_number  %}">Last Page</a>
{% endif %}&emsp;
{% for n in  pageList %}
    <a href="{% url 'USFP:adminViewUserSuggestions' commonUserID n  %}">{{ n }}</a> &emsp;
{% endfor %}
{% if prepageData.has_next %}
    <a href="{% url 'USFP:adminViewUserSuggestions' commonUserID prepageData.next_page_number  %}">Next Page</a>
{% endif %}&emsp;
<br>
<a href="{% url 'USFP:adminViewUser' commonUserID%}">Back</a>
</body>
</html>